<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Linktree</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
  </head>
  <body>
    <h1>Bem-vindo ao meu PWA</h1>
    <p>Adicione à tela inicial para uma experiência mais fluida.</p>

    <!-- Botão de instalação que será mostrado quando o prompt estiver disponível -->
    <button id="installButton" style="display: none;">Adicionar à Tela Inicial</button>

    <script type="text/javascript">
      // Variável para armazenar o evento beforeinstallprompt
      let deferredPrompt;

      // Captura o evento 'beforeinstallprompt'
      window.addEventListener('beforeinstallprompt', (e) => {
        // Previne o comportamento padrão do navegador
        e.preventDefault();

        // Armazena o evento para usá-lo mais tarde
        deferredPrompt = e;

        // Exibe o botão de instalação
        const installButton = document.getElementById('installButton');
        installButton.style.display = 'block';

        // Quando o usuário clicar no botão, exibe o prompt de instalação
        installButton.addEventListener('click', () => {
          // Mostra o prompt
          deferredPrompt.prompt();

          // Aguarda a resposta do usuário
          deferredPrompt.userChoice.then((choiceResult) => {
            console.log(choiceResult.outcome); // 'accepted' ou 'dismissed'
            deferredPrompt = null;  // Limpa o evento após o uso
            installButton.style.display = 'none'; // Esconde o botão após a interação

            // Após a escolha, redireciona para o Linktree (se necessário)
            if (choiceResult.outcome === 'accepted') {
              console.log('Usuário aceitou a instalação');
              // window.location.href = "https://linktr.ee/iasdlm.dc";  // Substitua com o seu Linktree
            }
          });
        });
      });

      // Registra o Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
          .then(function(registration) {
            console.log('Service Worker registrado com sucesso:', registration);
          })
          .catch(function(error) {
            console.log('Falha ao registrar o Service Worker:', error);
          });
      }

      // Verifique se o Service Worker foi registrado corretamente
      window.addEventListener('load', () => {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.ready.then(() => {
            console.log('Service Worker está ativo e pronto!');
          });
        }
      });
    </script>
  </body>
</html>
