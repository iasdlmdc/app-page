<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Service Worker e Atalho</title>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <button id="register-sw-btn">Registrar Service Worker</button>

  <script>
    let deferredPrompt;

    // Função para registrar o Service Worker
    function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
          .then((registration) => {
            console.log('Service Worker registrado com sucesso: ', registration);
          })
          .catch((error) => {
            console.log('Falha ao registrar o Service Worker: ', error);
          });
      } else {
        console.log('Service Workers não são suportados neste navegador.');
      }
    }

    // Capturando o evento beforeinstallprompt
    window.addEventListener('beforeinstallprompt', (event) => {
      console.log('beforeinstallprompt disparado');
      // Previne o comportamento padrão do navegador
      event.preventDefault();
      deferredPrompt = event;

      // Exibindo um botão para o usuário adicionar à tela inicial
      const installButton = document.createElement('button');
      installButton.textContent = 'Adicionar à Tela Inicial';
      document.body.appendChild(installButton);

      installButton.addEventListener('click', () => {
        if (deferredPrompt) {
          deferredPrompt.prompt(); // Mostra o prompt de instalação
          deferredPrompt.userChoice
            .then((choiceResult) => {
              console.log('Resultado da escolha: ', choiceResult.outcome); // 'accepted' ou 'dismissed'
              deferredPrompt = null; // Limpa a variável
            });
        }
      });
    });

    // Evento de registro do botão
    document.getElementById('register-sw-btn').addEventListener('click', () => {
      console.log('Botão de registro do Service Worker clicado');
      registerServiceWorker();
    });

    // Verificando se o PWA foi instalado
    window.addEventListener('appinstalled', (event) => {
      console.log('PWA foi instalado!');
    });

  </script>
</body>
</html>
